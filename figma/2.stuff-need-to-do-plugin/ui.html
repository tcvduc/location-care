<style>
  #add_form {
    width: 100%;
  }
  #input_enter_new_stuff {
    height: 40px;
    width: 160px;
    padding-left: 12px;
  }
  #add_new_stuff_button:dis {
    height: 40px;
    width: 100px;
    color: #fff;
    font-weight: bold;

    border: none;
    outline: none;
    background-image: linear-gradient(to bottom, #a2facf, #64acff);
    cursor: pointer;
  }
  .add_new_stuff_button_onclick {
    background-image: linear-gradient(to bottom, #a2facf, #64acff);
    opacity: 0.5;
    color: #fff;
    font-weight: bold;
  }

  .stuff {
    display: flex;
    flex-direction: row;
    justify-content: center;
    align-items: center;
    width: "100%";
    margin: 12px 0;
  }

  .stuffName {
    width: 70%;
    font-weight: bold;
  }
  .isDone {
    width: 30%;
    height: 30px;
    width: 30px;
  }

  #listStuff {
  }

  .add_new_stuff_button_disabled {
    opacity: 0.5;
    
  }

  #add_new_stuff_button:disabled{
    cursor: not-allowed;
    
  }
</style>

<div id="container">
  <div id="add_form">
    <input
      id="input_enter_new_stuff"
      type="text"
      placeholder="Enter new stuff"
    />
    <button id="add_new_stuff_button">Add</button>
  </div>

  <div id="listStuff"></div>
</div>

<script>
  function startScript() {
    const backendAPIURI = "http://localhost:1212";
    const stuffNeedToDoAPIURI = "/api/stuffNeedToDo";

    /**
     *
     * @param {HTMLInputElement} input_enter_new_stuff
     */
    function toggleDisableButtonAddNewStuff(input_enter_new_stuff) {
      if (input_enter_new_stuff.value.length === 0) {
        const add_new_stuff_button = document.getElementById(
          "add_new_stuff_button"
        );
        add_new_stuff_button.classList.add("add_new_stuff_button_disabled");
        // add_new_stuff_button.disabled = true;
      }

      if (input_enter_new_stuff.value.length !== 0) {
        const add_new_stuff_button = document.getElementById(
          "add_new_stuff_button"
        );
        add_new_stuff_button.classList.remove("add_new_stuff_button_disabled");
        // add_new_stuff_button.disabled = false;
      }
    }

    function disableAddButtonWhenFirstTimeRender() {
      const input_enter_new_stuff = document.getElementById(
        "input_enter_new_stuff"
      );
      input_enter_new_stuff.addEventListener("input", function () {
        toggleDisableButtonAddNewStuff(input_enter_new_stuff);
      });
      toggleDisableButtonAddNewStuff(input_enter_new_stuff);
    }

    /**
     *
     * @param {string} text
     * @param {number} index
     * @param {boolean} isDoneValue
     *
     */
    function createOneStuffNeedToDoElement(text, index, isDoneValue) {
      const stuffHTMLCode = `
<div class="stuff" >
  <span class="stuffName" >${index}. ${text}</span>
  <input  data-id={index} class="isDone" type="checkbox" checked={isDone} />
</div>
`;

      const stuff = document.createElement("div");
      stuff.classList.add("stuff");

      const stuffName = document.createElement("div");
      stuffName.classList.add("stuffName");

      const isDone = document.createElement("input");
      isDone.classList.add("isDone");
      isDone.type = "checkbox";
      isDone.checked = isDoneValue;
      isDone.setAttribute("data-id", index);

      stuffName.textContent = index + ". " + text;
      stuff.appendChild(stuffName);
      stuff.appendChild(isDone);

      return stuff;
    }

    async function getDataStuffNeedToDo() {
      const request_URI = backendAPIURI + stuffNeedToDoAPIURI;
      const fetchOptions = {
        // mode: "no-cors", // no-cors, *cors, same-origin
        mode: "cors", // no-cors, *cors, same-origin

        method: "GET", // *GET, POST, PUT, DELETE, etc.
        cache: "no-cache", // *default, no-cache, reload, force-cache, only-if-cached
        // credentials: "same-origin", // include, *same-origin, omit
        headers: {
          "Content-Type": "application/json",
          // 'Content-Type': 'application/x-www-form-urlencoded',
        },
        // redirect: "follow", // manual, *follow, error
        // referrerPolicy: "no-referrer", // no-referrer, *no-referrer-when-downgrade, origin, origin-when-cross-origin, same-origin, strict-origin, strict-origin-when-cross-origin, unsafe-url
        // body: JSON.stringify(data), // body data type must match "Content-Type" header
      };

      return new Promise((resolve) => {
        const ret1 = fetch(request_URI, fetchOptions)
          .then((res) => res.json())
          .then((ret) => {
            resolve(ret);
          });
      });
    }

    /**
     *
     * @param {string} stuffName
     */
    async function addNewStuff(stuffName) {
      const data = {
        stuffName: stuffName,
      };

      const fetchOptions = {
        method: "POST",
        headers: {
          "Content-Type": "application/json",
          // 'Content-Type': 'application/x-www-form-urlencoded',
        },
        body: JSON.stringify(data),
      };

      const ret = fetch(backendAPIURI + stuffNeedToDoAPIURI, fetchOptions)
        .then((ret) => ret.json())
        .then((ret) => {
          console.log(ret);
        });
    }

    function handleAddNewStuffButtonOnclick() {
      const add_new_stuff_button = document.getElementById(
        "add_new_stuff_button"
      );

      add_new_stuff_button.addEventListener("mousedown", async () => {
        add_new_stuff_button.classList.add("add_new_stuff_button_onclick");
        const input_enter_new_stuff = document.getElementById(
          "input_enter_new_stuff"
        );
        if (input_enter_new_stuff.value.length === 0) {
          const add_new_stuff_button = document.getElementById(
            "add_new_stuff_button"
          );
          add_new_stuff_button.setAttribute("disabled", true);
        }

        if (input_enter_new_stuff.value.length !== 0) {
          const add_new_stuff_button = document.getElementById(
            "add_new_stuff_button"
          );
          add_new_stuff_button.setAttribute("disabled", false);
        }

        const stuffName = input_enter_new_stuff.value;

        const ret = await addNewStuff(stuffName);
        console.log("ret: ", ret);
      });

      add_new_stuff_button.addEventListener("mouseup", () => {
        add_new_stuff_button.classList.remove("add_new_stuff_button_onclick");
      });
    }

    async function displayStuffNeedToDo() {
      const ret = await getDataStuffNeedToDo();

      const listStuff = document.getElementById("listStuff");
      listStuff.innerHTML = "";

      for (let i = ret.data.length - 1; i >= 0; --i) {
        const stuff = createOneStuffNeedToDoElement(
          ret.data[i].stuffName,
          ret.data[i].id,
          ret.data[i].isDone
        );
        listStuff.appendChild(stuff);
      }
    }

    async function handleCheckBoxesIsDoneOnclick() {
      const listIsDoneCheckBoxesInput =
        document.getElementsByClassName("isDone");

      for (let i = listIsDoneCheckBoxesInput.length - 1; i >= 0; --i) {
        listIsDoneCheckBoxesInput[i].onchange = async function (event) {
          const id = listIsDoneCheckBoxesInput[i].getAttribute("data-id");
          const isDone = event.target.checked;
          const retEdit = await editIsDoneStuff(id, isDone);
        };
      }
    }

    /**
     *
     * @param {Number} id
     * @param {boolean} isDone
     *
     */
    async function editIsDoneStuff(id, isDone) {
      const uri = backendAPIURI + stuffNeedToDoAPIURI;
      const data = {
        id: id,
        isDone: isDone,
      };
      const fetchOptions = {
        // mode: "no-cors", // no-cors, *cors, same-origin
        mode: "cors", // no-cors, *cors, same-origin

        method: "put", // *GET, POST, PUT, DELETE, etc.
        cache: "no-cache", // *default, no-cache, reload, force-cache, only-if-cached
        // credentials: "same-origin", // include, *same-origin, omit
        headers: {
          "Content-Type": "application/json",
          // 'Content-Type': 'application/x-www-form-urlencoded',
        },
        // redirect: "follow", // manual, *follow, error
        // referrerPolicy: "no-referrer", // no-referrer, *no-referrer-when-downgrade, origin, origin-when-cross-origin, same-origin, strict-origin, strict-origin-when-cross-origin, unsafe-url
        // body: JSON.stringify(data), // body data type must match "Content-Type" header
        body: JSON.stringify(data),
      };

      return new Promise((resolve) => {
        const ret = fetch(uri, fetchOptions)
          .then((ret) => ret.json())
          .then((ret) => {
            resolve(ret);
          });
      });
    }

    async function main() {
      disableAddButtonWhenFirstTimeRender();
      handleAddNewStuffButtonOnclick();
      await displayStuffNeedToDo();
      await handleCheckBoxesIsDoneOnclick();
    }

    {
      main();
    }
  }

  startScript();
</script>
